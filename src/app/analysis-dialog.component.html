<!-- ──────────────── SUMMARY ──────────────── -->
<mat-card class="section summary">
  <div class="date-row">
    <mat-icon>calendar_today</mat-icon>
    <span class="range">March&nbsp;1 – 30, 2025</span>
  </div>

  <div class="markdown" [innerHTML]="summaryHtml"></div>
</mat-card>

<!-- ──────────────── KPI GRID + SENTIMENT ──────────────── -->
<mat-card class="section kpi">
  <h3>Key Performance Indicators</h3>
  
  <div class="kpi-grid">
    <ng-container *ngFor="let k of objectKeys(displayKpi)">
      <div class="tile">
        <mat-icon>{{ getKpiIcon(k) }}</mat-icon>
        <div class="value">{{ displayKpi[k] }}</div>
        <div class="label">{{ k | metricLabel }}</div>
      </div>
    </ng-container>
  </div>

  <div class="sentiment">
    <h4>Call Analysis</h4>
    <span class="score">{{ data.kpi.answered_pct }}%</span>
    <div class="bar">
      <div class="good" [style.flex-basis.%]="data.kpi.answered_pct"></div>
      <div class="neutral" [style.flex-basis.%]="data.kpi.vm_pct || 0"></div>
      <div class="bad" [style.flex-basis.%]="data.kpi.missed_pct"></div>
    </div>
    <div class="legend">
      <span class="legend-item"><span class="color good"></span>Answered ({{ data.kpi.answered_pct }}%)</span>
      <span class="legend-item"><span class="color neutral"></span>Voicemail ({{ data.kpi.vm_pct }}%)</span>
      <span class="legend-item"><span class="color bad"></span>Missed ({{ data.kpi.missed_pct }}%)</span>
    </div>
  </div>

</mat-card>

<!-- ──────────────── TOP-LISTS ──────────────── -->
<mat-card class="section table">
  <h3><mat-icon>schedule</mat-icon>Top Talk-Time Owners</h3>
  <app-simple-table [rows]="data.top_talk"></app-simple-table>
</mat-card>

<mat-card class="section table">
  <h3><mat-icon>phone</mat-icon>Top External Numbers</h3>
  <app-simple-table [rows]="data.top_numbers"></app-simple-table>
</mat-card>

<mat-card class="section table">
  <h3><mat-icon>location_on</mat-icon>Top Call Locations</h3>
  <app-simple-table [rows]="data.top_locations"></app-simple-table>
</mat-card>

<mat-card class="section table">
  <h3><mat-icon>phone_missed</mat-icon>Missed Calls by Owner</h3>
  <app-simple-table [rows]="data.miss_by_owner"></app-simple-table>
</mat-card>

<mat-card class="section table">
  <h3><mat-icon>date_range</mat-icon>Daily Missed Call Trends</h3>
  <div class="scrollable-table">
    <app-simple-table [rows]="data.miss_days.slice(0, 20)"></app-simple-table>
  </div>
  <div class="table-footer" *ngIf="data.miss_days.length > 20">
    Showing 20 of {{ data.miss_days.length }} entries
  </div>
</mat-card>

<!-- ──────────────── CHARTS ──────────────── -->
<mat-card class="section charts">
  <img class="chart" [src]="'assets/' + data.charts.call_result"  alt="Call results">
  <img class="chart" [src]="'assets/' + data.charts.daily_volume" alt="Daily volume">
</mat-card>

<!-- ──────────────── MARKETING BANNER ──────────────── -->
<mat-card class="section marketing-banner cce-banner">
  <div class="banner-content">
    <div class="banner-icon">
      <mat-icon>support_agent</mat-icon>
    </div>
    <div class="banner-text">
      <h4>Looking for better control on your inbound calls?</h4>
      <p>Click here to learn how Call Center Essentials can help you succeed</p>
    </div>
    <div class="banner-arrow">
      <mat-icon>arrow_forward</mat-icon>
    </div>
  </div>
</mat-card>